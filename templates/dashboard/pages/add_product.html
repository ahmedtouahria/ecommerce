{% extends "dashboard/base.html" %}
 {% block content_dashboard %}
<h3 class="mx-5 pt-3">Add product</h3>
<div class="container-fluid pt-3">
  <form  method="post" enctype="multipart/form-data" id="form_add_product" >
    {% csrf_token %}
    <div class="previews"></div>

    <input class="form-control mb-4" name="name" placeholder="Name" multiple />
    <select
      name="category"
      class="form-select mb-4"
      aria-label="Default select example"
    >
      <option selected>select category</option>
      {% for cat in category %}
      <option>{{cat.name}}</option>
      {% endfor %}
    </select>
    <input
      class="form-control mb-4"
      type="number"
      name="price1"
      placeholder="Price 1"
    />
    <input
      class="form-control mb-4"
      type="number"
      name="price2"
      placeholder="Price 2"
    />
    <input
      class="form-control mb-4"
      type="number"
      name="quantity"
      placeholder="quantity"
    />
    <input
      class="form-control mb-4"
      name="description"
      placeholder="description"
    />
    <div class="upload__box">
      <div class="upload__btn-box">
        <label class="upload__btn">
          <i class="fa fa-upload fs-5" aria-hidden="true"></i>
          <input
            type="file"
            id="product_file"
            name="image"
            class="upload__inputfile"
          />
        </label>
      </div>
      <div class="upload__img-wrap"></div>
    </div>
    <div class="upload__box">
      <div class="upload__btn-box">
        <label class="upload__btn">
          <i class="fa fa-upload fs-5" aria-hidden="true"></i>
          <input
            type="file"
            id="product_file"
            name="images"
            multiple
            data-max_length="5"
            class="upload__inputfile"
          />
        </label>
      </div>
      <div class="upload__img-wrap"></div>
    </div>
    
   
    <input
      class="btn btn-outline-success btn-sm w-25"
      type="submit"
      placeholder="add"
    />
  </form>
  <div class="row">
    <div class="col-12 col-md-6">
      <div class="wrapper mb-4">
        <div class="title">
          <h2>Size & Color</h2>
        </div>
        <div class="content">
          <p>Press enter or add a comma after each tag</p>
          <label>sizes</label>

          <ul class="ul_tags">
            <input type="text" spellcheck="false" />
          </ul>
          <label>colors</label>

          <ul class="ul_tags2">

            <input type="text" spellcheck="false" />
          </ul>
        <div class="details">
          <p><span>10</span> tags are remaining</p>
        </div>
        <div class="details2">
          <p><span>10</span> tags are remaining</p>
        </div>
      </div>
    </div>
    <input
    class="btn btn-outline-info btn-sm w-25"
    placeholder="add"
    id="color_send"
  />
  </div>
</div>
<script>
  function getToken(name) {
    var cookieValue = null;
    if (document.cookie && document.cookie !== "") {
      var cookies = document.cookie.split(";");
      for (var i = 0; i < cookies.length; i++) {
        var cookie = cookies[i].trim();
        // Does this cookie string begin with the name we want?
        if (cookie.substring(0, name.length + 1) === name + "=") {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }
  // and we assign to variable csrftoken for post secure data
  var csrftoken = getToken("csrftoken");
  /*

 <------- SCRIPT TO ADD SIZE AND COLORS IN THE TAGS AND SEND THIS INTO SERVER --------->
  
  */
  let ul = document.querySelector(".ul_tags"),
        ul2 = document.querySelector(".ul_tags2"),
        input = document.querySelector(".ul_tags input "),
        tagNumb = document.querySelector(".details span");
         input2 = document.querySelector(".ul_tags2 input "),
         tagNumb2 = document.querySelector(".details2 span");

  let maxTags = 5;
  var tags = ["X", "L"]; // array of item tags
  var tags2 = ["black"]; // array of item tags


  countTags();
  createTag();
  countTags2();
  createTag2();
  function countTags() {
    input.focus();
    tagNumb.innerText = maxTags - tags.length;
  }
  function createTag() {
    ul.querySelectorAll("li").forEach((li) => li.remove());
    tags
      .slice()
      .reverse()
      .forEach((tag) => {
        let liTag = `<li>${tag} <i class="fa fa-remove" onclick="remove(this, '${tag}')"></i></li>`;
        ul.insertAdjacentHTML("afterbegin", liTag);
      });
    countTags();
  }

  function remove(element, tag) {
    let index = tags.indexOf(tag);
    tags = [...tags.slice(0, index), ...tags.slice(index + 1)];
    element.parentElement.remove();
    countTags();
    countTags2();

  }
  function remove2(element, tag) {
    let index = tags2.indexOf(tag);
    tags2 = [...tags2.slice(0, index), ...tags2.slice(index + 1)];
    element.parentElement.remove();

    countTags2();

  }

  function addTag(e) {
    if (e.which == 32) {
      let tag = e.target.value.replace(/\s+/g, " ");
      if (tag.length > 0 && !tags.includes(tag)) {
        tag.split(",").forEach((tag) => {
          tags.push(tag);
          console.log("sizes",tags);

          createTag();
        });
      }
      e.target.value = "";
    }
  }

  function countTags2() {
    input2.focus();
    tagNumb2.innerText = maxTags - tags2.length;
  }
  function createTag2() {
    ul2.querySelectorAll("li").forEach((li) => li.remove());
    tags2
      .slice()
      .reverse()
      .forEach((tag) => {
        let liTag = `<li>${tag} <i class="fa fa-remove" onclick="remove2(this, '${tag}')"></i></li>`;
        ul2.insertAdjacentHTML("afterbegin", liTag);
      });
    countTags2();
  }
  function addTag2(e) {
    if (e.which == 32) {
      let tag = e.target.value.replace(/\s+/g, " ");
      if (tag.length > 0 && !tags2.includes(tag)) {
        tag.split(",").forEach((tag) => {
          tags2.push(tag);
          console.log("colors :",tags2);

          createTag2();
        });
      }
      e.target.value = "";
    }
  }

  // ---- SEND REQUEST ---- ADD VARIATION
  const send = document.getElementById("color_send");
  send.addEventListener("click", function (e) {
    addFormData();
  });
  function addFormData() {
    data = {
      sizes: tags,
      colors:tags2,
    };
 
    fetch("/api/add_product/", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "X-CSRFToken": csrftoken,
      },
      body: JSON.stringify(data),
    }).then((res) => {
      console.log("Request complete! response:", res);
    })
    .then((data) => {
      location.reload()
  });
    
  }

  input.addEventListener("keyup", addTag);
  input2.addEventListener("keyup", addTag2);


  // send post request to add product
</script>
{% endblock content_dashboard %}
