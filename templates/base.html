{% load static %}
<!DOCTYPE html>
<html>
  <head>
    <!-- Mobile Specific Meta -->
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <!-- Favicon-->
    <link rel="shortcut icon" href="/media/{{config.LOGO}}" />
    <!-- Author Meta -->
    <meta name="author" content="CodePixar" />
    <!-- Meta Description -->
    <meta name="description" content="" />
    <!-- Meta Keyword -->
    <meta name="keywords" content="" />

    <!-- meta character set -->
    <meta charset="UTF-8" />
    <!-- Site Title -->
    <title>Ahmed Shop | {{titel}}</title>
    <!--===============================CSS============================================= -->


    <link
      rel="stylesheet"
      rel="preload"
      href="{% static 'css/nice-select.css'%}"
    />
    <link
      rel="stylesheet"
      rel="preload"
      href="{% static 'css/bootstrap.min.css'%}"
    />
    <link
      rel="stylesheet"
      rel="preload"
      href="{% static 'css/font-awesome.min.css'%}"
    />
    <link
      rel="stylesheet"
      rel="preload"
      href="{% static 'css/new_style.min.css'%}"
    />
    {% block css %} {% endblock css %}
  </head>
  <body>
    <div id="loading" class="container">
      <a class="card" id="card-link" target="_blank">
        <div class="card__header">
          <div>
            <img
              class="card__header header__img skeleton"
              id="logo-img"
              alt=""
            />
          </div>
          <h3 class="card__header header__title" id="card-title">
            <div class="skeleton skeleton-text1"></div>
          </h3>
        </div>

        <div class="card__body">
          <div class="card__body body__text" id="card-details">
            <div class="row">
              <div class="col-12 col-md-3">
                <div class="skeleton skeleton-text skeleton-text__body"></div>
              </div>
              <div class="col-12 col-md-3">
                <div class="skeleton skeleton-text skeleton-text__body"></div>
              </div>
              <div class="col-12 col-md-3">
                <div class="skeleton skeleton-text skeleton-text__body"></div>
              </div>
              <div class="col-12 col-md-3">
                <div class="skeleton skeleton-text skeleton-text__body"></div>
              </div>
            </div>
          </div>

          <div class="card__body body__img">
            <img class="skeleton" alt="" id="cover-img" />
          </div>
        </div>

        <div class="card__footer" id="card-footer">
          <div class="skeleton skeleton-text skeleton-footer"></div>
        </div>
      </a>
    </div>
    <div id="body" class="d-none">
      {% include 'partes/navbar.html' %} {% block content %} {% endblock %} 
    {% include 'partes/footer.html' %}
    </div>
    <script src="{% static 'js/vendor/jquery-2.2.4.min.js' %}"></script>
    <script>
      // optimzation css loading
      $(document).ready(function(){
      const loading = $("#loading");
      const body = $("#body");
        loading.addClass("d-none");
        body.removeClass("d-none");
        $("select").niceSelect();
        $(".s_Product_carousel").owlCarousel({
          items: 1,
          autoplay: true,
          autoplayTimeout: 5000,
          loop: true,
          nav: false,
          dots: true,
        });
      })
    </script>
    <script src="{% static 'js/vendor/bootstrap.min.js' %}"></script>
    <script src="{% static 'js/nouislider.min.js'%}"></script>
    <script src="{% static 'js/jquery.nice-select.min.js' %}"></script>
    <script src="{% static 'js/owl.carousel.min.js'%}"></script>
    <script type="text/javascript">
      var total = "{{order.get_cart_total}}";
      var user = "{{request.user}}";
      var user_id = "{{request.user.id}}";
      var name = user;
      var phone = "{{request.user.phone}}";
      // Function to get TOKENT
      function getToken(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie !== "") {
          var cookies = document.cookie.split(";");
          for (var i = 0; i < cookies.length; i++) {
            var cookie = cookies[i].trim();
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) === name + "=") {
              cookieValue = decodeURIComponent(
                cookie.substring(name.length + 1)
              );
              break;
            }
          }
        }
        return cookieValue;
      }
      // and we assign to variable csrftoken for post secure data
      var csrftoken = getToken("csrftoken");
      // function to get cookie
      function getCookie(name) {
        // Split cookie string and get all individual name=value pairs in an array
        var cookieArr = document.cookie.split(";");

        // Loop through the array elements
        for (var i = 0; i < cookieArr.length; i++) {
          var cookiePair = cookieArr[i].split("=");
          /* Removing whitespace at the beginning of the cookie name
		        and compare it with the given string */
          if (name == cookiePair[0].trim()) {
            // Decode the cookie value and return
            return decodeURIComponent(cookiePair[1]);
          }
        }
        // Return null if not found
        return null;
      }
      var cart = JSON.parse(getCookie("cart"));
      if (cart == undefined) {
        cart = {};
        console.log("Cart Created!", cart);
        document.cookie = "cart=" + JSON.stringify(cart) + ";domain=;path=/";
      }
      function getCartItem() {
        $.ajax({
          url: "/api/cartitemApi/",
          type: "GET",
          success: function (res) {
            console.log(res.cartItem);
            $(".cartItem").html(res.cartItem);
          },
        });
      }
      console.log("Cart:", cart);
      // object cart (container shopping bug user GUEST)
      var cart = JSON.parse(getCookie("cart"));
      if (cart == undefined) {
        cart = {};
        console.log("Cart Created!", cart);
        document.cookie = "cart=" + JSON.stringify(cart) + ";domain=;path=/";
      }
      function getCartItem() {
        $.ajax({
          url: "/api/cartitemApi/",
          type: "GET",
          success: function (res) {
            console.log(res.cartItem);
            $(".cartItem").html(res.cartItem);
          },
        });
      }
      console.log("Cart:", cart);
    </script>
    <script>
        //ADD THIS PIECE OF CODE IN YOUR JS OR HTML PAGE UNDER SCRIPT
      "use strict";
      $(document).ready(function () {
        //search .autocomplete
       let search_nav = $("#search_nav");
        let result_nav = $("#result_product ul");
        search_nav.keyup(function (e) {
          result_nav.html("");
          let data = $(this).val();
          if ($.trim(data).length > 0) {
            $.ajax({
              url: "/api/products/",
              type: "GET",
              data: {
                search: data,
              },
              success: function (res) {
                if(res.length>0)
                $.each(res, function (key, value) { result_nav.append(
                    `<li class="d-flex my-2 "><img src="${value.image}" height="30" width="30"><a style="color: black;font-weight: 500; " class="mx-2"href="/products/${value.slug}">${value.name}</a></li>`
                  );
                });
                else
                  result_nav.append(
                    `<li class="d-flex my-2"><a style="color: black;font-weight: 500;" class="mx-2">Aucun r√©sultat</a></li>`
                  );
              },
            });
          }
        });
        const tabs = document.querySelectorAll("[data-target]"),
        tabContents = document.querySelectorAll("[data-content]");
        tabs.forEach((tab) => {
        tab.addEventListener("click", () => {
        const target = document.querySelector(tab.dataset.target);
        tabContents.forEach((tc) => {
              tc.classList.remove("is-active");
            });
        target.classList.add("is-active");

        tabs.forEach((t) => {
              t.classList.remove("is-active");
            });
            tab.classList.add("is-active");
          });
        });

        $(".custom-select").niceSelect("destroy");
        //--------- script to hundel sidebar for mini devices---------//
        $("#sidebarCollapse").on("click", function () {
          $("#sidebar").addClass("active");
        });
        $("#sidebarCollapseX").on("click", function () {
          $("#sidebar").removeClass("active");
        });
        $("#sidebarCollapse").on("click", function () {
          if ($("#sidebar").hasClass("active")) {
            $(".overlay").addClass("visible");
            // console.log("it's working!");
          }
        });
        $("#sidebarCollapseX").on("click", function () {
          $(".overlay").removeClass("visible");
        });
        setTimeout(() => {
          if ($("#alert").length > 0) {
            $("#alert").fadeOut();
          }
        }, 4000);
        //--------end script to hundel sidebar for mini devices--------//

        //--- END--script realtime filter ----//
      });
      //})
    </script>
    <script>
      // mobile menu variables
      const mobileMenuOpenBtn = document.querySelectorAll(
        "[data-mobile-menu-open-btn]"
      );
      const mobileMenu = document.querySelectorAll("[data-mobile-menu]");
      const mobileMenuCloseBtn = document.querySelectorAll("[data-mobile-menu-close-btn]");
      const overlay = document.querySelector("[data-overlay]");
      for (let i = 0; i < mobileMenuOpenBtn.length; i++) {
        // mobile menu function
        const mobileMenuCloseFunc = function () {
          mobileMenu[i].classList.remove("active");
          overlay.classList.remove("active");
        };
        mobileMenuOpenBtn[i].addEventListener("click", function () {
        mobileMenu[i].classList.add("active");
          overlay.classList.add("active");
        });
        mobileMenuCloseBtn[i].addEventListener("click", mobileMenuCloseFunc);
        overlay.addEventListener("click", mobileMenuCloseFunc);
      }
      // accordion variables
      const accordionBtn = document.querySelectorAll("[data-accordion-btn]");
      const accordion = document.querySelectorAll("[data-accordion]");
      for (let i = 0; i < accordionBtn.length; i++) {
        accordionBtn[i].addEventListener("click", function () {
          const clickedBtn =
            this.nextElementSibling.classList.contains("active");
          for (let i = 0; i < accordion.length; i++) {
            if (clickedBtn) break;
            if (accordion[i].classList.contains("active")) {
              accordion[i].classList.remove("active");
              accordionBtn[i].classList.remove("active");
            }
          }
          this.nextElementSibling.classList.toggle("active");
          this.classList.toggle("active");
        });
      }
    </script>
    <style>
      .filters {
        font-family: sans-serif;
      }
      .filters-content {
        margin: 2rem 0 2.5rem;
        background-color: #eee;
        padding: 0.375rem;
        border-radius: 0.75rem;
        display: flex;
        justify-content: space-between;
        column-gap: 0.5rem;
      }
      .filters__button {
        width: 100%;
        border: none;
        outline: none;
        padding: 1rem;
        transition: 0.3s;
        border-radius: 0.5rem;
      }
      .filters__button:hover {
        background-color: #fff;
      }
      /* Hide*/
      .filters [data-content] {
        display: none;
      }
      [data-content].is-active[data-content] {
        display: grid;
      }
      [data-target].is-active {
        background-color: #ff6c00;
        color: #fff;
      }
      .skeleton {
        animation: skeleton-loading 1s linear infinite alternate;
      }

      @keyframes skeleton-loading {
        0% {
          background-color: hsl(200, 20%, 80%);
        }
        100% {
          background-color: hsl(200, 20%, 95%);
        }
      }

      .skeleton-text1,
      .skeleton-text {
        width: 100%;
        height: 1.2rem;
        margin-bottom: 0.5rem;
        border-radius: 0.25rem;
      }
      .skeleton-text1 {
        height: 15rem;
      }
      .skeleton-text__body {
        width: 75%;
        height: 5rem;
      }

      .skeleton-footer {
        width: 30%;
        height: 1rem;
      }
    </style>
  </body>
</html>
