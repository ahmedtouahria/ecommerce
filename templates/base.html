{% load static %}
<!DOCTYPE html>
<html>
  <head>
    <!-- Mobile Specific Meta -->
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <!-- Favicon-->
    <link rel="shortcut icon" href="{% static 'img/fav.png' %}" />
    <!-- Author Meta -->
    <meta name="author" content="CodePixar" />
    <!-- Meta Description -->
    <meta name="description" content="" />
    <!-- Meta Keyword -->
    <meta name="keywords" content="" />

    <!-- meta character set -->
    <meta charset="UTF-8" />
    <!-- Site Title -->
    <title>Ahmed Shop | {{titel}}</title>
    <!--===============================CSS============================================= -->
    <link
      rel="stylesheet"
      rel="preload"
      href="{% static 'css/linearicons.css'%}"
    />
    <link rel="stylesheet" rel="preload" href="{% static 'css/new_style.css'%}" />
    <link
      rel="stylesheet"
      rel="preload"
      href="{% static 'css/themify-icons.css'%}"
    />
    <link rel="stylesheet" href="{% static 'css/bootstrap.css'%}" />
    <link rel="stylesheet" href="{% static 'css/nice-select.css'%}" />

    <link
    rel="stylesheet"
    rel="preload"
    href="{% static 'css/main.css'%}"
  />
  {% block css %}
  
  {% endblock css %}
  </head>
  <body>
    {% include 'partes/navbar.html' %} {% block content %} {% endblock %} 
    {% include 'partes/footer.html' %}
    <script>
    // optimzation css loading 
      window.addEventListener('load', () => {
        let link = document.createElement('link');
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = "{% static 'css/main.css'%}";
        document.head.appendChild(link)
        let link2 = document.createElement('link');
        link2.rel = 'stylesheet';
        link2.type = 'text/css';
        link2.href = "{% static 'css/font-awesome.min.css'%}";
        document.head.appendChild(link2)
      })
    </script>
    <script src="{% static 'js/vendor/jquery-2.2.4.min.js'%}"></script>
    <script async src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
    <script src="{% static 'js/vendor/bootstrap.min.js'%}"></script>
    <script src="{% static 'js/jquery.nice-select.min.js'%}"></script>
    <script async src="{% static 'js/nouislider.min.js'%}"></script>
    <script async src="{% static 'js/jquery.magnific-popup.min.js'%}"></script>
    <script async src="{% static 'js/owl.carousel.min.js'%}"></script>
    <script async src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
    <script
      type="module"
      src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"
    ></script>
    <script
      nomodule
      src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"
    ></script>
    {% comment %}
    <script src="{% static 'js/script.js'%}"></script>
    {% endcomment %} {% comment %}
    <script src="{% static 'js/script.js'%}"></script>
    {% endcomment %}

    <script type="text/javascript">
  
      var total = "{{order.get_cart_total}}";
      var user = "{{request.user}}";
      var user_id = "{{request.user.id}}";
      var name = "{{request.user.name}}";
      var phone = "{{request.user.phone}}";
      // Function to get TOKENT
      function getToken(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie !== "") {
          var cookies = document.cookie.split(";");
          for (var i = 0; i < cookies.length; i++) {
            var cookie = cookies[i].trim();
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) === name + "=") {
              cookieValue = decodeURIComponent(
                cookie.substring(name.length + 1)
              );
              break;
            }
          }
        }
        return cookieValue;
      }
      // and we assign to variable csrftoken for post secure data
      var csrftoken = getToken("csrftoken");
      // function to get cookie
      function getCookie(name) {
        // Split cookie string and get all individual name=value pairs in an array
        var cookieArr = document.cookie.split(";");

        // Loop through the array elements
        for (var i = 0; i < cookieArr.length; i++) {
          var cookiePair = cookieArr[i].split("=");

          /* Removing whitespace at the beginning of the cookie name
		        and compare it with the given string */
          if (name == cookiePair[0].trim()) {
            // Decode the cookie value and return
            return decodeURIComponent(cookiePair[1]);
          }
        }
        // Return null if not found
        return null;
      }
      var cart = JSON.parse(getCookie("cart"));
      if (cart == undefined) {
        cart = {};
        console.log("Cart Created!", cart);
        document.cookie = "cart=" + JSON.stringify(cart) + ";domain=;path=/";
      }
      function getCartItem() {
        $.ajax({
          url: "/api/cartitemApi/",
          type: "GET",
          success: function (res) {
            console.log(res.cartItem);
            $(".cartItem").html(res.cartItem);
          },
        });
      }
      console.log("Cart:", cart);
      // object cart (container shopping bug user GUEST)
      var cart = JSON.parse(getCookie("cart"));
      if (cart == undefined) {
        cart = {};
        console.log("Cart Created!", cart);
        document.cookie = "cart=" + JSON.stringify(cart) + ";domain=;path=/";
      }
      function getCartItem() {
        $.ajax({
          url: "/api/cartitemApi/",
          type: "GET",
          success: function (res) {
            console.log(res.cartItem);
            $(".cartItem").html(res.cartItem);
          },
        });
      }
      console.log("Cart:", cart);
      // simple code to hundler update cart whene user chose a product
      // var updateBtns = document.getElementsByClassName("update-cart");
      /*  for (i = 0; i < updateBtns.length; i++) {
        updateBtns[i].addEventListener("click", function () {
          var productId = this.dataset.product;
          var action = this.dataset.action;
          console.log("productId:", productId, "Action:", action);
          console.log("USER:", user);
          if (user == "AnonymousUser") {
            addCookieItem(productId, action);
            console.log("user is not login");
          } else {
            // for avoid duplicate request in ajax we need disable button
            _this.attr("disabled", "disabled");
            updateUserOrder(productId, action);
            _this.removeAttr("disabled");

            console.log("user is logged in");
          }
        });
      }*/
      // update order whene user is authenticated
      /*  function updateUserOrder(productId, action) {
        $.ajax({
          type: "POST",
          beforeSend: function (request) {
            request.setRequestHeader("Content-Type", "application/json");
            request.setRequestHeader("X-CSRFToken", csrftoken);
          },
          url: "/update_item/",
          data: JSON.stringify({ productId: productId, action: action }),
          processData: true,
          success: function (msg) {
            console.log("success" + msg);
          },
        });
        // for display async in cart items without reload page
        getCartItem();
      }
      // update order whene user is not authenticated
      function addCookieItem(productId, action) {
        console.log("User is not authenticated");
        if (action == "add") {
          if (cart[productId] == undefined) {
            cart[productId] = { quantity: 1 };
          } else {
            cart[productId]["quantity"] += 1;
          }
        }
        if (action == "remove") {
          cart[productId]["quantity"] -= 1;

          if (cart[productId]["quantity"] <= 0) {
            console.log("Item should be deleted");
            delete cart[productId];
          }
        }
        console.log("CART:", cart);
        document.cookie = "cart=" + JSON.stringify(cart) + ";domain=;path=/";
        getCartItem();
      }*/
      // hundel checkout and order
      /* var form = document.getElementById("form");
      form.addEventListener("submit", function (e) {
        e.preventDefault();
        submitFormData();
      });*/

      // function swite alert to hundel beutifule alert
      // success alert
      function fireSweetAlert() {
        const Toast = Swal.mixin({
          toast: true,
          position: "top",
          showConfirmButton: false,
          timer: 3000,
          timerProgressBar: true,
          didOpen: (toast) => {
            toast.addEventListener("mouseenter", Swal.stopTimer);
            toast.addEventListener("mouseleave", Swal.resumeTimer);
          },
        });

        Toast.fire({
          icon: "success",
          title: "order sent successfully !",
        });
      }
      // error alert
      function fireSweetAlertError() {
        const Toast = Swal.mixin({
          toast: true,
          position: "top",
          showConfirmButton: false,
          timer: 3000,
          timerProgressBar: true,
          didOpen: (toast) => {
            toast.addEventListener("mouseenter", Swal.stopTimer);
            toast.addEventListener("mouseleave", Swal.resumeTimer);
          },
        });
        Toast.fire({
          icon: "error",
          title: "order has a problem !",
        });
      }
    </script>
    <script>
      //ADD THIS PIECE OF CODE IN YOUR JS OR HTML PAGE UNDER SCRIPT

      $(document).ready(function () {
        $("select").niceSelect();
        $(".s_Product_carousel").owlCarousel({
          items: 1,
          autoplay: false,
          autoplayTimeout: 5000,
          loop: true,
          nav: false,
          dots: true,
        });

        const tabs = document.querySelectorAll("[data-target]"),
          tabContents = document.querySelectorAll("[data-content]");
        tabs.forEach((tab) => {
          tab.addEventListener("click", () => {
            const target = document.querySelector(tab.dataset.target);
            tabContents.forEach((tc) => {
              tc.classList.remove("is-active");
            });
            target.classList.add("is-active");

            tabs.forEach((t) => {
              t.classList.remove("is-active");
            });
            tab.classList.add("is-active");
          });
        });

        $(".custom-select").niceSelect("destroy");

        //--------- script to hundel sidebar for mini devices---------//
        $("#sidebarCollapse").on("click", function () {
          $("#sidebar").addClass("active");
        });
        $("#sidebarCollapseX").on("click", function () {
          $("#sidebar").removeClass("active");
        });
        $("#sidebarCollapse").on("click", function () {
          if ($("#sidebar").hasClass("active")) {
            $(".overlay").addClass("visible");
            // console.log("it's working!");
          }
        });
        $("#sidebarCollapseX").on("click", function () {
          $(".overlay").removeClass("visible");
        });
        setTimeout(() => {
          if ($("#alert").length > 0) {
            $("#alert").fadeOut();
          }
        }, 4000);
        //--------end script to hundel sidebar for mini devices--------//

        //--- END--script realtime filter ----//
      });
      //})
    </script>
    <script>
      // mobile menu variables
      const mobileMenuOpenBtn = document.querySelectorAll(
        "[data-mobile-menu-open-btn]"
      );
      const mobileMenu = document.querySelectorAll("[data-mobile-menu]");
      const mobileMenuCloseBtn = document.querySelectorAll(
        "[data-mobile-menu-close-btn]"
      );
      const overlay = document.querySelector("[data-overlay]");

      for (let i = 0; i < mobileMenuOpenBtn.length; i++) {
        // mobile menu function
        const mobileMenuCloseFunc = function () {
          mobileMenu[i].classList.remove("active");
          overlay.classList.remove("active");
        };

        mobileMenuOpenBtn[i].addEventListener("click", function () {
          mobileMenu[i].classList.add("active");
          overlay.classList.add("active");
        });

        mobileMenuCloseBtn[i].addEventListener("click", mobileMenuCloseFunc);
        overlay.addEventListener("click", mobileMenuCloseFunc);
      }

      // accordion variables
      const accordionBtn = document.querySelectorAll("[data-accordion-btn]");
      const accordion = document.querySelectorAll("[data-accordion]");

      for (let i = 0; i < accordionBtn.length; i++) {
        accordionBtn[i].addEventListener("click", function () {
          const clickedBtn =
            this.nextElementSibling.classList.contains("active");

          for (let i = 0; i < accordion.length; i++) {
            if (clickedBtn) break;

            if (accordion[i].classList.contains("active")) {
              accordion[i].classList.remove("active");
              accordionBtn[i].classList.remove("active");
            }
          }

          this.nextElementSibling.classList.toggle("active");
          this.classList.toggle("active");
        });
      }
    </script>
    <style>
      
     
      .country_select ul.list {
        max-height: 350px;
        overflow-y: scroll !important;
      }
      .country_select ul.list::-webkit-scrollbar {
        width: 15px;
      }

      .country_select ul.list::-webkit-scrollbar-track {
        background: var(--white);
        border-left: 1px solid var(--cultured);
      }

      .country_select ul.list::-webkit-scrollbar-thumb {
        background: hsl(0, 0%, 80%);
        border: 3px solid var(--white);
        border-radius: 10px;
      }

      .country_select ul.list::-webkit-scrollbar-thumb:hover {
        background: hsl(0, 0%, 70%);
      }

      .filters {
        font-family: sans-serif;
      }
      .filters-content {
        margin: 2rem 0 2.5rem;
        background-color: #eee;
        padding: 0.375rem;
        border-radius: 0.75rem;
        display: flex;
        justify-content: space-between;
        column-gap: 0.5rem;
      }
      .filters__button {
        width: 100%;
        border: none;
        outline: none;
        padding: 1rem;
        transition: 0.3s;
        border-radius: 0.5rem;
      }
      .filters__button:hover {
        background-color: #fff;
      }
      /* Hide*/
      .filters [data-content] {
        display: none;
      }
      [data-content].is-active[data-content] {
        display: grid;
      }
      [data-target].is-active {
        background-color: #4042f6;
        color: #fff;
      }
      .skeleton {
  animation: skeleton-loading 1s linear infinite alternate;
}

@keyframes skeleton-loading {
  0% {
    background-color: hsl(200, 20%, 80%);
  }
  100% {
    background-color: hsl(200, 20%, 95%);
  }
}

.skeleton-text {
  width: 100%;
  height: 0.7rem;
  margin-bottom: 0.5rem;
  border-radius: 0.25rem;
}

.skeleton-text__body {
  width: 75%;
}

.skeleton-footer {
  width: 30%;
}
    </style>
  </body>
</html>
